// ğŸ“„ prisma/schema.prisma

datasource db {
  provider = "mysql" // ë˜ëŠ” "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id         String    @id
  nickname   String
  image      String?
  tests      Test[]
  comments   Comment[]
  likes      Like[]
}

model Test {
  id          Int        @id @default(autoincrement())
  title       String
  titleImage  String
  setting     String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  userId      String
  user        User       @relation(fields: [userId], references: [id])
  questions   Question[]
  results     Result[]
  comments    Comment[]
  likes       Like[]
}

model Question {
  id        Int       @id @default(autoincrement())
  title     String
  body      String
  image     String
  type      QuestionType
  testId    Int
  test      Test      @relation(fields: [testId], references: [id])
  options   Option[]  // ê°ê´€ì‹ì¼ ê²½ìš°ë§Œ ì¡´ì¬
}

model Option {
  id         Int     @id @default(autoincrement())
  text       String
  questionId Int
  question   Question @relation(fields: [questionId], references: [id])
}

model Result {
  id          Int     @id @default(autoincrement())
  name        String
  description String     // ì‚¬ìš©ììš© ì„¤ëª…
  setting     String     // AIìš© ì„¤ëª…
  image       String
  testId      Int
  test        Test    @relation(fields: [testId], references: [id])

  saveResults SavedResult[]
}

model Like {
  id      Int    @id @default(autoincrement())
  userId  String
  testId  Int
  user    User   @relation(fields: [userId], references: [id])
  test    Test   @relation(fields: [testId], references: [id])

  @@unique([userId, testId]) // 1ì¸ 1í…ŒìŠ¤íŠ¸ 1ì¢‹ì•„ìš” ì œí•œ
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())
  userId    String
  testId    Int
  user      User     @relation(fields: [userId], references: [id])
  test      Test     @relation(fields: [testId], references: [id])
}

enum QuestionType {
  subjective  // ì£¼ê´€ì‹
  objective   // ê°ê´€ì‹
}

model SavedResult {
  id        String   @id @default(cuid()) // ê³µìœ  ê°€ëŠ¥í•œ ê³ ìœ  ID
  resultId  Int
  result    Result   @relation(fields: [resultId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}
